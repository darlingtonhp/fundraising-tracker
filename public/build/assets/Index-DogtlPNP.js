import{r as l,W as R,j as e,d as c,a as U}from"./app-Bp2RtXpQ.js";import{A as O}from"./AuthenticatedLayout-DuNq7-2H.js";import{I as V,T as P}from"./TextInput-DjZIdFdo.js";import{I as y}from"./InputLabel-CkJUODWM.js";import"./transition-BWKuXZR1.js";function K({auth:T,contributions:r,permissions:S}){const[i,u]=l.useState("all"),[d,g]=l.useState(""),[I,x]=l.useState(!1),[n,F]=l.useState(null),[f,j]=l.useState(!1),{data:q,setData:M,post:D,errors:A,reset:E}=R({csv_file:null}),{canEdit:p,canDelete:b,canImport:N,canCreate:v}=S;l.useEffect(()=>{(async()=>{try{j(!0);const a=await(await fetch(route("contributions.mitupo-data"))).json();F(a)}catch(s){console.error("Failed to fetch mitupo data:",s)}finally{j(!1)}})()},[]);const w=l.useMemo(()=>{const t={};return r.forEach(s=>{const a=s.mutupo.name;t[a]||(t[a]={mutupo:s.mutupo,contributions:[],totalAmount:0,totalTshirts:0,totalCementBags:0}),t[a].contributions.push(s),t[a].totalAmount+=parseFloat(s.total_contributed),t[a].totalTshirts+=s.no_of_tshirts,t[a].totalCementBags+=s.no_of_cement_bags}),Object.values(t).sort((s,a)=>s.mutupo.name.localeCompare(a.mutupo.name))},[r]),m=l.useMemo(()=>w.filter(t=>i!=="all"&&t.mutupo.name!==i?!1:d?t.contributions.some(a=>a.contributor_name.toLowerCase().includes(d.toLowerCase())||a.contributor_type.name.toLowerCase().includes(d.toLowerCase())):!0),[w,i,d]),$=l.useMemo(()=>["all",...[...new Set(r.map(s=>s.mutupo.name))].sort()],[r]),k=r.reduce((t,s)=>t+parseFloat(s.total_contributed),0),_=r.reduce((t,s)=>t+s.no_of_tshirts,0),C=r.reduce((t,s)=>t+s.no_of_cement_bags,0),L=t=>{t.preventDefault(),D(route("contributions.import"),{onSuccess:()=>{E(),x(!1)}})},B=()=>{window.location.href=route("contributions.export")},G=()=>{let t=`contributor_name,mutupo_id,contributor_type_id,no_of_tshirts,no_of_cement_bags,cement_amount
`;t+=`John Doe,1,1,2,0,0
`,t+=`Jane Smith,2,2,0,3,45.00
`,t+=`Mike Johnson,3,3,1,2,30.00

`,t+=`VALID MUTUPO IDs:
`,n&&n.mitupos?n.mitupos.forEach(h=>{t+=`- ${h.id}: ${h.name}${h.description?` (${h.description})`:""}
`}):t+=`- 1: Shava
- 2: Mhofu
- 3: Moyo
- 4: Shumba
- 5: Soko
- 6: Gumbo
- 7: Ngwena
`,t+=`
CONTRIBUTOR TYPE IDs:
`,t+=`- 1: External Guest
- 2: Internal Guest
- 3: Fundraising Task Force Member
`,t+=`
IMPORTANT NOTES:
`,t+=`- contributor_name must be unique (no duplicates)
`,t+=`- mutupo_id must match an existing mutupo ID from the list above
`,t+=`- contributor_type_id must be 1, 2, or 3
`,t+=`- no_of_tshirts and no_of_cement_bags must be whole numbers (0 or greater)
`,t+=`- cement_amount should be in USD format (e.g., 45.00)
`,t+=`- T-shirt amount is automatically calculated ($7 per shirt)
`,t+="- Total contribution is automatically calculated (T-shirts + cement amount)";const s=new Blob([t],{type:"text/csv"}),a=window.URL.createObjectURL(s),o=document.createElement("a");o.href=a,o.download="contributions_template.csv",document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(a)};return e.jsxs(O,{user:T.user,header:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight",children:"Contributions"}),e.jsxs("div",{className:"flex space-x-2",children:[N&&e.jsx("button",{onClick:()=>x(!0),className:"bg-blue-500 px-3 py-2 text-white rounded shadow transition-all hover:bg-blue-600 text-sm font-medium",children:"Import CSV"}),e.jsx("button",{onClick:B,className:"bg-green-500 px-3 py-2 text-white rounded shadow transition-all hover:bg-green-600 text-sm font-medium",children:"Export CSV"}),v&&e.jsx(c,{href:route("contributions.create"),className:"bg-emerald-500 px-3 py-2 text-white rounded shadow transition-all hover:bg-emerald-600 text-sm font-medium",children:"Add New Contribution"})]})]}),children:[e.jsx(U,{title:"Contributions"}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[I&&N&&e.jsx("div",{className:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg mb-6",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Import Contributions from CSV"}),e.jsx("button",{onClick:()=>x(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:"✕"})]}),e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 mb-4",children:[e.jsx("h4",{className:"font-semibold text-yellow-800 dark:text-yellow-300 mb-2",children:"Import Instructions:"}),e.jsxs("ul",{className:"text-sm text-yellow-700 dark:text-yellow-400 list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Download the template below to see the required format"}),e.jsx("li",{children:"CSV must include these exact columns: contributor_name, mutupo_id, contributor_type_id, no_of_tshirts, no_of_cement_bags, cement_amount"}),e.jsx("li",{children:"mutupo_id must match existing Mitupo IDs (see template for valid IDs)"}),e.jsx("li",{children:"contributor_type_id: 1=External Guest, 2=Internal Guest, 3=Fundraising Task Force Member"}),e.jsx("li",{children:"File must be in CSV format with UTF-8 encoding"})]})]}),e.jsxs("div",{className:"flex space-x-4 mb-4",children:[e.jsx("button",{onClick:G,disabled:f,className:"bg-gray-500 hover:bg-gray-600 disabled:bg-gray-400 text-white px-4 py-2 rounded text-sm transition-all",children:f?"Loading...":"Download Template"}),e.jsx(c,{href:route("mitupos.index"),className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded text-sm transition-all",children:"View Mitupo List"})]}),n&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-4",children:[e.jsx("h4",{className:"font-semibold text-blue-800 dark:text-blue-300 mb-2",children:"Available Mutupo:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 text-sm",children:n.mitupos.map(t=>e.jsxs("div",{className:"text-blue-700 dark:text-blue-400",children:[e.jsx("span",{className:"font-mono",children:t.id}),":"," ",t.name,t.description&&e.jsx("span",{className:"text-blue-600 dark:text-blue-300 text-xs block",children:t.description})]},t.id))})]}),e.jsxs("form",{onSubmit:L,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(y,{htmlFor:"csv_file",value:"CSV File *"}),e.jsx("input",{id:"csv_file",type:"file",accept:".csv",className:"mt-1 block w-full border-gray-300 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",onChange:t=>M("csv_file",t.target.files[0])}),e.jsx(V,{message:A.csv_file,className:"mt-2"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Maximum file size: 10MB"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>x(!1),className:"bg-gray-100 px-4 py-2 text-gray-800 rounded shadow transition-all hover:bg-gray-200 text-sm",children:"Cancel"}),e.jsx("button",{type:"submit",className:"bg-blue-500 px-4 py-2 text-white shadow transition-all hover:bg-blue-600 text-sm",children:"Import Contributions"})]})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg mb-6",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"search",value:"Search Contributors"}),e.jsx(P,{id:"search",type:"text",value:d,className:"mt-1 block w-full",onChange:t=>g(t.target.value),placeholder:"Search by contributor name or type..."})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"mitupoFilter",value:"Filter by Mutupo"}),e.jsx("select",{id:"mitupoFilter",value:i,onChange:t=>u(t.target.value),className:"mt-1 block w-full border-gray-300 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",children:$.map(t=>e.jsx("option",{value:t,children:t==="all"?"All Mutupo":t},t))})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>{g(""),u("all")},className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded shadow transition-all text-sm w-full",children:"Clear Filters"})})]}),(d||i!=="all")&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-blue-700 dark:text-blue-300 font-medium",children:"Active filters:"}),d&&e.jsxs("span",{className:"bg-blue-100 dark:bg-blue-800 text-blue-800 dark:text-blue-200 px-2 py-1 rounded-full text-xs",children:['Search: "',d,'"']}),i!=="all"&&e.jsxs("span",{className:"bg-blue-100 dark:bg-blue-800 text-blue-800 dark:text-blue-200 px-2 py-1 rounded-full text-xs",children:["Mutupo: ",i]})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-sm font-bold",children:"👤"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Total Contributors"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:r.length})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-sm font-bold",children:"👕"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Total T-Shirts"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:_})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-sm font-bold",children:"🏗️"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Cement Bags"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:C})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-emerald-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-sm font-bold",children:"$"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Total Raised"}),e.jsxs("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:["$",k.toFixed(2)]})]})]})})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg",children:e.jsx("div",{className:"p-6 text-gray-900 dark:text-gray-100",children:m.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 dark:text-gray-500 text-6xl mb-4",children:"📊"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-lg mb-4",children:r.length===0?"No contributions found.":"No contributions match your search criteria."}),r.length===0&&v?e.jsx(c,{href:route("contributions.create"),className:"inline-block bg-blue-500 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-all",children:"Add Your First Contribution"}):e.jsx("button",{onClick:()=>{g(""),u("all")},className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-all",children:"Clear Filters"})]}):e.jsx("div",{className:"space-y-8",children:m.map(t=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 px-6 py-4 border-b border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:t.mutupo.name}),t.mutupo.description&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t.mutupo.description})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[t.contributions.length," contributor",t.contributions.length!==1?"s":""]}),e.jsxs("div",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:["$",t.totalAmount.toFixed(2)]})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Contributor"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"T-Shirts"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Cement Bags"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Total Contribution"}),(p||b)&&e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:t.contributions.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:s.contributor_name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.contributor_type.name==="External Guest"?"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200":s.contributor_type.name==="Internal Guest"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200"}`,children:s.contributor_type.name})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm text-gray-900 dark:text-gray-100",children:[s.no_of_tshirts," pcs"]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["$",s.tshirt_amount]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm text-gray-900 dark:text-gray-100",children:[s.no_of_cement_bags," bags"]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["$",s.cement_amount]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm font-semibold text-green-600 dark:text-green-400",children:["$",parseFloat(s.total_contributed).toFixed(2)]})}),(p||b)&&e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-3",children:[p&&e.jsx(c,{href:route("contributions.edit",s.id),className:"text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300 transition-colors",children:"Edit"}),b&&e.jsx(c,{href:route("contributions.destroy",s.id),method:"delete",as:"button",className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 transition-colors",onClick:a=>{confirm("Are you sure you want to delete this contribution?")||a.preventDefault()},children:"Delete"})]})})]},s.id))}),e.jsx("tfoot",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"2",className:"px-6 py-3 text-sm font-semibold text-gray-900 dark:text-gray-100 text-right",children:"Group Total:"}),e.jsxs("td",{className:"px-6 py-3 text-sm font-semibold text-gray-900 dark:text-gray-100",children:[t.totalTshirts," pcs"]}),e.jsxs("td",{className:"px-6 py-3 text-sm font-semibold text-gray-900 dark:text-gray-100",children:[t.totalCementBags," bags"]}),e.jsxs("td",{className:"px-6 py-3 text-sm font-bold text-green-600 dark:text-green-400",children:["$",t.totalAmount.toFixed(2)]}),e.jsx("td",{})]})})]})})]},t.mutupo.id))})})}),m.length>0&&e.jsx("div",{className:"mt-6 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-800 dark:text-green-300 font-semibold text-lg",children:"Grand Total Across All Mutupo"}),e.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400",children:["Showing"," ",m.reduce((t,s)=>t+s.contributions.length,0)," ","of ",r.length," contributions"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:["$",k.toFixed(2)]}),e.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400",children:[_," T-Shirts • ",C," Cement Bags"]})]})]})})]})})]})}export{K as default};
